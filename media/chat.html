<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet"  href="chat.css">
</head>
<body>
    <div class="header">
        <span class="logo">LASK .ai</span>
        <div class="icons">
            <img src="${profileIconUri}" alt="Profile" class="icon" />
            <img src="${infoIconUri}" alt="Info" class="icon" />
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" id="chat-tab">Chat</button>
        <button class="tab" id="context-tab">Add Context</button>
    </div>

    

    <div class="to-hide">
        <div class="action-buttons">
            <button class="action">+ New</button>
            <button class="action">History</button>
        </div>

        <div class="welcome-content">
            <h1>Welcome to Lask AI Chat, your coding partner!</h1>
            <p>Select the block of code that you're focusing on.</p>
            <p>Then, you can either click on one of the actions listed below, type your request into the prompt area, or use the "/" command to quickly access specific actions.</p>
            <p><a href="#">Check out the user guide</a></p>
        </div>

        <div class="action-list">
            <button class="action-item" id="explain-code">Explain Code</button>
            <button class="action-item" id="write-docstrings">Write docstrings for code</button>
            <button class="action-item" id="generate-tests">Generate Test cases</button>
            <button class="action-item" id="explore-codebase">Explore Codebase</button>
            <button class="action-item" id="fix-code">Fix code</button>
        </div>
    </div>
    
    <!-- Chat Container -->
    <div class="chat-container" id="chatContainer">
        <div class="messages" id="messages"></div>
        <div class="input-container">
            <button class="action" id="/">/</button>
            <button class="action" id="@">@</button>
            <input type="text" id="messageInput" placeholder="Type a message...">
        </div>
        <div class="send-buttons">
            <button id="sendButton">Ask AI</button>
            <button id="generateCodeButton">Generate Code</button>
        </div>
    </div>
    
    <!-- Context Container -->
    <div class="context-container" id="contextContainer" style="display:none;">
        <!-- Context content goes here -->
        <h1>Context View</h1>
        <p>This is the context view where you can add context-related information.</p>
        <!-- Additional context-related elements can be added here -->
    </div>


    
    <!-- Load marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Load highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <script src="chat.js"></script>
    <!-- Inside chat.html -->
<script>
    const messageInput = document.getElementById('messageInput');
    const commandSuggestions = document.getElementById('commandSuggestions');

    // Show command suggestions when "/" is typed
    messageInput.addEventListener('input', function () {
        const text = messageInput.value;
        if (text.startsWith('/')) {
            commandSuggestions.style.display = 'block'; // Show suggestions
            const commandList = ['explain', 'generateCode', 'fix']; // List of slash commands
            const matchingCommands = commandList.filter(cmd => cmd.startsWith(text.slice(1)));
            commandSuggestions.innerHTML = matchingCommands.map(cmd => `<li>${cmd}</li>`).join('');
        } else {
            commandSuggestions.style.display = 'none'; // Hide suggestions
        }
    });

    // Handle suggestion click
    commandSuggestions.addEventListener('click', function (event) {
        const command = event.target.textContent;
        messageInput.value = `/${command} `;
        commandSuggestions.style.display = 'none'; // Hide suggestions
    });

    // Submit message (Slash command)
    document.getElementById('sendMessageButton').addEventListener('click', function () {
        const message = messageInput.value.trim();
        if (message.startsWith('/')) {
            const command = message.split(' ')[0].slice(1);
            const args = message.split(' ').slice(1).join(' ');

            // Post the slash command message to the extension
            vscode.postMessage({
                command: command,
                args: args
            });
        } else {
            // Normal chat message handling
            vscode.postMessage({
                command: 'sendMessage',
                text: message
            });
        }
        messageInput.value = '';
    });
</script>

<ul id="commandSuggestions" style="display:none; position:absolute; background:#fff;">
    <!-- Slash command suggestions appear here -->
</ul>

</body>
</html>
